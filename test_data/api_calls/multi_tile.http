# @name anonymousSession
POST http://localhost:3030/api/login
Content-Type: application/json

{
  "email": "admin@localhost",
  "password": "adminadmin"
}

###
# @name dataset
POST http://localhost:3030/api/dataset
Content-Type: application/json
Authorization: Bearer {{anonymousSession.response.body.$.id}}

< ../raster/multi_tile/metadata/dataset_irregular.json

###

# @name workflow
POST http://localhost:3030/api/workflow
Authorization: Bearer {{anonymousSession.response.body.$.id}}
Content-Type: application/json

{
  "type": "Raster",
  "operator": {
    "type": "MultiBandGdalSource",
    "params": {
      "data": "{{dataset.response.body.$.datasetName}}"
    }
  }
}

###

POST http://localhost:3030/api/dataset/{{dataset.response.body.$.datasetName}}/tiles
Content-Type: application/json
Authorization: Bearer {{anonymousSession.response.body.$.id}}

< ../raster/multi_tile/metadata/loading_info.json


###
@colorizer = %7B%22type%22%3A%22singleBand%22%2C%22band%22%3A0%2C%22bandColorizer%22%3A%7B%22type%22%3A%22palette%22%2C%22colors%22%3A%7B%2210000%22%3A%5B31%2C119%2C180%2C255%5D%2C%2210001%22%3A%5B174%2C199%2C232%2C255%5D%2C%2210010%22%3A%5B255%2C127%2C14%2C255%5D%2C%2210011%22%3A%5B44%2C160%2C44%2C255%5D%2C%2210100%22%3A%5B152%2C223%2C138%2C255%5D%2C%2210101%22%3A%5B214%2C39%2C40%2C255%5D%2C%2210110%22%3A%5B148%2C103%2C189%2C255%5D%2C%2210111%22%3A%5B197%2C176%2C213%2C255%5D%2C%2211000%22%3A%5B140%2C86%2C75%2C255%5D%2C%2211001%22%3A%5B227%2C119%2C194%2C255%5D%2C%2211010%22%3A%5B247%2C182%2C210%2C255%5D%2C%2211011%22%3A%5B127%2C127%2C127%2C255%5D%2C%2211100%22%3A%5B188%2C189%2C34%2C255%5D%2C%2211101%22%3A%5B219%2C219%2C141%2C255%5D%2C%2211110%22%3A%5B23%2C190%2C207%2C255%5D%2C%2211111%22%3A%5B158%2C218%2C229%2C255%5D%7D%2C%22noDataColor%22%3A%5B0%2C0%2C0%2C0%5D%2C%22defaultColor%22%3A%5B0%2C0%2C0%2C0%5D%7D%7D

###

GET http://localhost:3030/api/wms/{{workflow.response.body.$.id}}?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&FORMAT=image%2Fpng&STYLES=custom%3A{{colorizer}}&TRANSPARENT=true&layers={{workflow.response.body.$.id}}&time=2025-01-01T00%3A00%3A00.000Z&EXCEPTIONS=application%2Fjson&WIDTH=1800&HEIGHT=900&CRS=EPSG%3A4326&BBOX=-90%2C-180%2C90%2C180
Authorization: Bearer {{anonymousSession.response.body.$.id}}

### Share with users

PUT http://localhost:3030/api/permissions
Authorization: Bearer {{anonymousSession.response.body.$.id}}
Content-Type: application/json

 {
    "resource": {
        "type": "dataset",
        "id": "{{dataset.response.body.$.datasetName}}"
    },
    "roleId": "4e8081b6-8aa6-4275-af0c-2fa2da557d28",
    "permission": "Read"
}

### Share wit hanonymous

PUT http://localhost:3030/api/permissions
Authorization: Bearer {{anonymousSession.response.body.$.id}}
Content-Type: application/json

 {
    "resource": {
        "type": "dataset",
        "id": "{{dataset.response.body.$.datasetName}}"
    },
    "roleId": "fd8e87bf-515c-4f36-8da6-1a53702ff102",
    "permission": "Read"
}